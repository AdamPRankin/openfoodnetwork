%div{"data-hook" => "admin_order_form_fields"}
  - if @line_item.try(:errors).present?
    = render :partial => 'spree/shared/error_messages', :locals => { :target => @line_item }

  = render :partial => "spree/admin/orders/shipment", :collection => @order.shipments, :locals => { :order => order }

  - if order.adjustments.eligible.exists?
    %fieldset.no-border-bottom
      %legend= Spree.t('adjustments')
      %table
        %thead
          %th= Spree.t('name')
          %th= Spree.t('amount')
        %tbody#order-charges.with-border{"data-hook" => "order_details_adjustments"}
          - order.adjustments.eligible.each do |adjustment|
            - next if ((adjustment.originator_type == 'Spree::TaxRate') and (adjustment.amount == 0)) || adjustment.originator_type == 'Spree::ShippingMethod'
            %tr.total
              %td
                %strong
                  = adjustment.label
                  \:
              %td.total.align-center
                %span= adjustment.display_amount

  - if order.line_items.exists?
    %fieldset#order-total.no-border-bottom{"data-hook" => "order_details_total"}
      %legend= Spree.t(:order_total)
      %span.order-total= order.display_total

  = form_for @order, url: admin_order_url(@order), method: :put do |f|
    = render partial: 'spree/admin/orders/_form/distribution_fields'

    .filter-actions.actions{"ng-show" => "distributionChosen()"}
      = button t(:update_and_recalculate_fees), 'icon-refresh'
      %span.or
        = t(:or)
      = link_to_with_icon 'button icon-arrow-left', t(:back), admin_orders_url

  = javascript_tag do
    var order_number = '#{@order.number}';
    var shipments = [];
    - @order.shipments.each do |shipment|
      shipments.push(#{shipment.to_json(:root => false, :include => [:inventory_units, :stock_location]).html_safe});
    = render :partial => 'spree/admin/shared/update_order_state', :handlers => [:js]
